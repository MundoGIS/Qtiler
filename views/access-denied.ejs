<%
  const deniedHeadStyles = String.raw`
    <style>
      body {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--bg, #f8fafc);
        color: var(--fg, #0f172a);
      }
      .denied-card {
        max-width: 540px;
        padding: 40px 34px;
        border-radius: 18px;
        background: var(--card, #ffffff);
        border: 1px solid var(--border, rgba(15, 23, 42, 0.08));
        box-shadow: var(--shadow, 0 20px 40px rgba(15, 23, 42, 0.1));
        text-align: center;
      }
      .denied-card h1 {
        margin: 0 0 12px 0;
        font-size: 26px;
      }
      .denied-card p {
        margin: 0 0 18px 0;
        color: var(--muted, #475569);
        line-height: 1.6;
      }
      .denied-actions {
        margin-top: 24px;
      }
      .denied-button {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 12px 20px;
        border-radius: 999px;
        background: var(--primary, #2563eb);
        color: #fff;
        text-decoration: none;
        font-weight: 600;
      }
    </style>
  `;
%>
<%- include('partials/html-open', {
  pageLang,
  pageTitle: 'Qtiler · Access denied',
  pageTitleI18nKey: 'access.title',
  inlineHeadContent: deniedHeadStyles
}) %>
    <%- include('partials/header', {
      headerMode: 'access',
      headerTaglineKey: 'access.title',
      headerTaglineText: 'Access denied',
      user,
      activeNav: activeNav || 'dashboard'
    }) %>
    <div class="denied-card" role="alert">
      <h1 data-i18n="access.heading">Access denied</h1>
      <p data-i18n="access.detail">Your account is not authorized to view the Qtiler dashboard. If you need access, please contact an administrator.</p>
      <p data-i18n="access.tip">You can still use any WMTS endpoints that have been shared with you directly.</p>
      <div class="denied-actions">
        <a class="denied-button" href="/login" data-i18n="access.cta">Return to sign in</a>
      </div>
    </div>

    <script>
      (function () {
        const SUPPORTED_LANGS = (window.qtilerLang && Array.isArray(window.qtilerLang.SUPPORTED_LANGS))
          ? window.qtilerLang.SUPPORTED_LANGS
          : ["en", "es", "sv"];
        const normalizeLang = window.qtilerLang?.normalize || ((value) => {
          const raw = (value || "").toLowerCase();
          if (SUPPORTED_LANGS.includes(raw)) return raw;
          const base = raw.split("-")[0];
          return SUPPORTED_LANGS.includes(base) ? base : "en";
        });
        let currentLang = window.qtilerLang?.get?.() || normalizeLang(localStorage.getItem("qtiler.lang") || navigator.language || "en");

        const TRANSLATIONS = {
          en: {
            "Dashboard": "Dashboard",
            "User guide": "User guide",
            "Language": "Language",
            "Tile caching console for QGIS projects.": "Tile caching console for QGIS projects.",
            "access.title": "Qtiler · Access denied",
            "access.heading": "Access denied",
            "access.detail": "Your account is not authorized to view the Qtiler dashboard. If you need access, please contact an administrator.",
            "access.tip": "You can still use any WMTS endpoints that have been shared with you directly.",
            "access.cta": "Return to sign in"
          },
          es: {
            "Dashboard": "Panel principal",
            "User guide": "Guía de uso",
            "Language": "Idioma",
            "Tile caching console for QGIS projects.": "Consola de teselado para proyectos QGIS.",
            "access.title": "Qtiler · Acceso denegado",
            "access.heading": "Acceso denegado",
            "access.detail": "Tu cuenta no está autorizada para ver el panel de Qtiler. Si necesitas acceso, contacta con un administrador.",
            "access.tip": "Puedes seguir usando los endpoints WMTS que se hayan compartido contigo.",
            "access.cta": "Volver a iniciar sesión"
          },
          sv: {
            "Dashboard": "Översikt",
            "User guide": "Användarguide",
            "Language": "Språk",
            "Tile caching console for QGIS projects.": "Cachekonsol för QGIS-projekt.",
            "access.title": "Qtiler · Åtkomst nekad",
            "access.heading": "Åtkomst nekad",
            "access.detail": "Ditt konto har inte behörighet till Qtilers instrumentpanel. Kontakta en administratör om du behöver åtkomst.",
            "access.tip": "Du kan fortfarande använda WMTS-endpoints som delats med dig.",
            "access.cta": "Tillbaka till inloggning"
          }
        };

        const languageSelect = document.getElementById('language_selector');

        const tr = (key) => {
          if (!key) return '';
          const table = TRANSLATIONS[currentLang] || {};
          return table[key] ?? (TRANSLATIONS.en && TRANSLATIONS.en[key]) ?? key;
        };

        const applyTranslations = () => {
          if (document?.documentElement) {
            document.documentElement.setAttribute('lang', currentLang);
          }
          const pageTitle = document.querySelector('title[data-i18n="access.title"]');
          if (pageTitle) pageTitle.textContent = tr('access.title');
          document.querySelectorAll('[data-i18n]').forEach((el) => {
            const key = el.getAttribute('data-i18n');
            if (!key) return;
            el.textContent = tr(key);
          });
          if (languageSelect) {
            languageSelect.value = currentLang;
          }
        };

        const setLanguage = (lang) => {
          if (window.qtilerLang?.set) {
            window.qtilerLang.set(lang);
            return;
          }
          currentLang = normalizeLang(lang);
          try {
            localStorage.setItem('qtiler.lang', currentLang);
          } catch {}
          applyTranslations();
        };

        if (languageSelect) {
          languageSelect.value = currentLang;
          languageSelect.addEventListener('change', (event) => setLanguage(event.target.value));
        }

        if (window.qtilerLang?.subscribe) {
          window.qtilerLang.subscribe((lang) => {
            const normalized = normalizeLang(lang);
            if (normalized === currentLang) return;
            currentLang = normalized;
            applyTranslations();
          });
        }

        applyTranslations();
      })();
    </script>
<%- include('partials/html-close') %>
