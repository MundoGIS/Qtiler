<!--
  This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
  If a copy of the MPL was not distributed with this file, You can obtain one at https://mozilla.org/MPL/2.0/.
  Copyright (C) 2025 MundoGIS.
-->
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title data-i18n="guide.pageTitle">User Guide ¬∑ Qtiler</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="/styles.css">
    <style>
      .guide-main {
        width: 100%;
        max-width: 960px;
        margin: 0 auto;
        padding: 60px 28px 80px;
      }

      .guide-topbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
        margin-bottom: 32px;
      }

      .guide-button {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 10px 16px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: var(--primary-soft);
        color: var(--primary);
        font-weight: 600;
        text-decoration: none;
        transition: transform 0.15s ease, border-color 0.2s ease, background 0.2s ease;
      }

      .guide-button:hover,
      .guide-button:focus {
        transform: translateY(-1px);
        border-color: var(--primary-600);
        background: rgba(37, 99, 235, 0.18);
        text-decoration: none;
      }

      .guide-language-select {
        padding: 8px 12px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: var(--card);
        color: var(--fg);
        font-weight: 600;
        min-width: 160px;
        box-shadow: var(--shadow);
      }

      @media (max-width: 600px) {
        .guide-topbar {
          flex-direction: column;
          align-items: stretch;
        }

        .guide-language-select {
          width: 100%;
        }
      }

      .guide-hero {
        text-align: center;
        margin-bottom: 48px;
      }

      .guide-hero h1 {
        font-size: 36px;
        margin: 0 0 12px 0;
        letter-spacing: -0.5px;
      }

      .guide-hero p {
        margin: 0;
        color: var(--muted);
        font-size: 16px;
      }

      .guide-badge {
        display: inline-flex;
        padding: 4px 10px;
        border-radius: 999px;
        background: var(--primary-soft);
        color: var(--primary);
        font-weight: 600;
        letter-spacing: 0.3px;
        font-size: 12px;
        margin-bottom: 18px;
      }

      .guide-section {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 18px;
        padding: 28px;
        box-shadow: var(--shadow);
        margin-bottom: 32px;
      }

      .guide-section h2 {
        margin-top: 0;
        margin-bottom: 18px;
        font-size: 22px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .guide-section h2 span:first-child {
        display: inline-flex;
        width: 30px;
        height: 30px;
        align-items: center;
        justify-content: center;
        border-radius: 10px;
        background: var(--primary-soft);
        color: var(--primary);
        font-weight: 600;
        font-size: 14px;
      }

      .guide-main p,
      .guide-main li {
        font-size: 15px;
        line-height: 1.65;
        color: var(--fg);
      }

      .guide-main ul,
      .guide-main ol {
        margin: 0;
        padding-left: 20px;
      }

      code {
        font-family: "Cascadia Code", Consolas, "Fira Code", monospace;
        background: rgba(15, 23, 42, 0.08);
        padding: 2px 5px;
        border-radius: 6px;
        font-size: 13px;
      }

      .tip {
        margin-top: 18px;
        padding: 16px;
        background: var(--primary-soft);
        border-left: 3px solid var(--primary);
        border-radius: 12px;
      }

      .grid {
        display: grid;
        gap: 18px;
      }

      @media (min-width: 860px) {
        .grid.two {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
      }

      .card-mini {
        background: var(--card);
        border-radius: 14px;
        padding: 18px;
        border: 1px solid rgba(15, 23, 42, 0.08);
      }

      .card-mini h3 {
        margin: 0 0 10px 0;
        font-size: 17px;
        color: var(--primary);
      }

      .guide-note {
        text-align: center;
        margin-top: 32px;
        color: var(--muted);
        font-size: 13px;
      }
    </style>
  </head>
  <body>
    <div class="app-shell guide-shell">
      <header class="app-header">
        <div class="header-inner">
          <div class="brand">
            <a href="/index.html" class="brand-logo">Qtiler</a>
            <span class="brand-tagline" data-i18n="Guide">Guide</span>
          </div>
          <nav class="main-nav" aria-label="Primary">
            <a href="/index.html" class="nav-link" data-i18n="Dashboard">Dashboard</a>
            <a href="/guide.html" class="nav-link is-active" aria-current="page" data-i18n="Guide">Guide</a>
            <a href="/viewer.html" class="nav-link" target="_blank" rel="noopener" data-i18n="Tile viewer">Tile viewer</a>
            <div class="nav-divider" aria-hidden="true"></div>
            <label class="visually-hidden" for="language_selector" data-i18n="Language">Language</label>
            <select id="language_selector" class="input-select nav-language-select" aria-label="Language">
              <option value="en">English</option>
              <option value="es">Espa√±ol</option>
              <option value="sv">Svenska</option>
            </select>
          </nav>
        </div>
      </header>

      <main class="app-main">
        <div class="guide-main">
          <div class="guide-topbar">
            <a class="guide-button" href="/index.html" data-i18n="guide.back">‚¨Ö Back to dashboard</a>
            <select id="guide_language_selector" class="guide-language-select" aria-label="Language">
              <option value="en">English</option>
              <option value="es">Espa√±ol</option>
              <option value="sv">Svenska</option>
            </select>
          </div>

          <section class="guide-hero">
            <span class="guide-badge">Qtiler ¬∑ MundoGIS</span>
            <h1 data-i18n="guide.heroTitle">Quick Start &amp; Workflow Guide</h1>
            <p data-i18n="guide.heroSubtitle">Everything you need to prepare QGIS projects, generate layer or theme caches with Qtiler, and publish production-ready WMTS.</p>
          </section>

          <section class="guide-section">
            <h2><span>1</span> <span data-i18n="guide.section1Title">Getting ready</span></h2>
            <div class="grid two">
              <div class="card-mini">
                <h3 data-i18n="guide.prepareQgis">Prepare QGIS</h3>
                <ul>
                  <li data-i18n="guide.prepareQgis.step1">Create and save your project in QGIS 3.x with all layers styled.</li>
                  <li data-i18n="guide.prepareQgis.step2">Define "Map Themes" (a.k.a. Kartteman) for every layer combination you want to cache as a composite.</li>
                  <li data-i18n-html="guide.prepareQgis.step3">Save the project (<code>Ctrl+S</code>) before uploading so the themes are persisted.</li>
                </ul>
              </div>
              <div class="card-mini">
                <h3 data-i18n="guide.setupServer">Set up the server</h3>
                <ul>
                  <li data-i18n-html="guide.setupServer.step1">Install OSGeo4W or the standalone QGIS build and configure <code>QGIS_PREFIX</code>, <code>OSGEO4W_BIN</code>, <code>PYTHON_EXE</code>.</li>
                  <li data-i18n-html="guide.setupServer.step2">Launch Qtiler with <code>npm start</code> (default <code>http://localhost:3000</code>).</li>
                  <li data-i18n-html="guide.setupServer.step3">Optional: install the Windows Service via <code>node service\\install-service.js</code>.</li>
                </ul>
              </div>
            </div>
            <div class="tip" data-i18n-html="guide.tip1">Already copied projects into <code>qgisprojects/</code>? Just click <strong>Reload layers</strong> to rebuild the list.</div>
          </section>

          <section class="guide-section">
            <h2><span>2</span> <span data-i18n="guide.section2Title">Dashboard workflow</span></h2>
            <p style="margin-bottom:18px;color:var(--muted)" data-i18n-html="guide.dashboardIntro">Here is the end-to-end flow inside the dashboard. Drop your own annotated screenshots into <code>public/assets</code> and update the references below if you want inline visuals.</p>
            <div class="grid two" style="margin-bottom:22px;">
              <div class="card-mini">
                <h3 data-i18n="guide.dashboardOverview">Dashboard overview</h3>
                <p data-i18n-html="guide.dashboardOverview.body">Screenshot placeholder. Replace <code>dashboard-overview.png</code> with your own capture.</p>
                <div style="margin-top:10px;border:1px dashed var(--border);border-radius:10px;overflow:hidden;background:var(--card);">
                  <img src="assets/dashboard-overview.png" alt="Dashboard overview" style="width:100%;display:block;" onerror="this.parentElement.innerHTML='Upload public/assets/dashboard-overview.png';" />
                </div>
              </div>
              <div class="card-mini">
                <h3 data-i18n="guide.layerControls">Layer controls</h3>
                <p data-i18n-html="guide.layerControls.body">Show layer actions (play, delete, copy URL, viewer). Replace <code>layer-controls.png</code> with your own image.</p>
                <div style="margin-top:10px;border:1px dashed var(--border);border-radius:10px;overflow:hidden;background:var(--card);">
                  <img src="assets/layer-controls.png" alt="Layer controls" style="width:100%;display:block;" onerror="this.parentElement.innerHTML='Upload public/assets/layer-controls.png';" />
                </div>
              </div>
            </div>
            <div class="grid two">
              <div class="card-mini">
                <h3 data-i18n="guide.uploadRefresh">1Ô∏è‚É£ Upload or refresh projects</h3>
                <p data-i18n-html="guide.uploadRefresh.body">Use <strong>Upload project</strong> for `.qgs/.qgz` files. Qtiler drops them into <code>qgisprojects/</code> and extracts layers, CRS, extent, and themes. Manual copies work too‚Äîjust hit <strong>Reload layers</strong>.</p>
              </div>
              <div class="card-mini">
                <h3 data-i18n="guide.adjustZoom">2Ô∏è‚É£ Adjust zoom and extent</h3>
                <p data-i18n-html="guide.adjustZoom.body">Set global min/max zoom and open <strong>Show extent map</strong> when you need precise bounding boxes. The map supports deep zoom (‚âà1:100) so you can refine the box in WGS84.</p>
              </div>
              <div class="card-mini">
                <h3 data-i18n="guide.cachePerLayer">3Ô∏è‚É£ Cache per layer</h3>
                <p data-i18n="guide.cachePerLayer.intro">Each layer row offers:</p>
                <ul>
                  <li data-i18n="guide.cachePerLayer.option1">‚ñ∂ Generate/refresh cache.</li>
                  <li data-i18n="guide.cachePerLayer.option2">üóë Delete stored tiles.</li>
                  <li data-i18n="guide.cachePerLayer.option3">üìã Copy tile URL (`/wmts/&lt;project&gt;/&lt;layer&gt;/{z}/{x}/{y}.png`).</li>
                  <li data-i18n="guide.cachePerLayer.option4">üëÅ Open the Leaflet viewer in the layer‚Äôs native CRS.</li>
                </ul>
              </div>
              <div class="card-mini">
                <h3 data-i18n="guide.cachePerTheme">4Ô∏è‚É£ Cache per theme</h3>
                <p data-i18n-html="guide.cachePerTheme.body">The <strong>Map Themes</strong> section lists every theme found. Use ‚ñ∂ to generate the composite mosaic (`/wmts/&lt;project&gt;/themes/&lt;theme&gt;/‚Ä¶`). Copy the WMTS URL and preview it in the viewer.</p>
              </div>
            </div>
          </section>

          <section class="guide-section">
            <h2><span>3</span> <span data-i18n="guide.section3Title">Jobs &amp; automation</span></h2>
            <div class="grid two">
              <div class="card-mini">
                <h3 data-i18n="guide.projectWideCache">Project-wide cache</h3>
                <p data-i18n-html="guide.projectWideCache.body"><strong>Cache all layers</strong> launches a batch job that iterates over every layer with the current parameters. The ‚ÄúRunning tasks‚Äù panel tracks progress live.</p>
              </div>
              <div class="card-mini">
                <h3 data-i18n="guide.scheduledRecache">Scheduled recache</h3>
                <p data-i18n-html="guide.scheduledRecache.body">Open the recache menu to define minute-based intervals. The server records last result and next run inside <code>project-config.json</code>.</p>
              </div>
            </div>
            <div class="tip" data-i18n-html="guide.tip2">Caches live under <code>cache/&lt;project&gt;/</code>. Each run updates <code>index.json</code> with <code>kind</code>, zooms, source layers, and timestamps.</div>
          </section>

          <section class="guide-section">
            <h2><span>4</span> <span data-i18n="guide.section4Title">Publishing WMTS</span></h2>
            <p data-i18n-html="guide.section4.body">The backend exposes a minimal GetCapabilities endpoint at <code>/wmts?SERVICE=WMTS&amp;REQUEST=GetCapabilities&amp;project=&lt;id&gt;</code>. All cached layers and themes appear as individual WMTS layers with ready-to-use templates.</p>
            <div class="grid two">
              <div class="card-mini">
                <h3 data-i18n="guide.gisIntegration">GIS client integration</h3>
                <ul>
                  <li data-i18n="guide.gisIntegration.body1">Load the Capabilities URL to register every layer at once.</li>
                  <li data-i18n="guide.gisIntegration.body2">Use individual tile URLs when you only need a specific resource.</li>
                  <li data-i18n-html="guide.gisIntegration.body3">Themes are identified as <code>&lt;project&gt;:&lt;theme&gt;</code> and stored under <code>_themes/</code>.</li>
                </ul>
              </div>
              <div class="card-mini">
                <h3 data-i18n="guide.leafletViewer">Leaflet viewer</h3>
                <p data-i18n-html="guide.leafletViewer.body">The built-in viewer (<code>viewer.html</code>) handles custom CRS via Proj4, displays a scale bar, and allows extra zoom-in to validate tile quality before publishing.</p>
              </div>
            </div>
          </section>

          <section class="guide-section">
            <h2><span>5</span> <span data-i18n="guide.section5Title">Best practices</span></h2>
            <ul>
              <li data-i18n="guide.bestPractice1">Keep QGIS projects and themes organized‚Äînames map directly to WMTS paths.</li>
              <li data-i18n="guide.bestPractice2">Monitor disk usage; WMTS caches can grow fast. Clean up unused layers regularly.</li>
              <li data-i18n-html="guide.bestPractice3">Review logs (`logs/`) and UI status messages to catch render errors early.</li>
              <li data-i18n="guide.bestPractice4">Use dedicated Windows accounts and background services for production deployments.</li>
            </ul>
          </section>

          <p class="guide-note" data-i18n="guide.footer">
            Need to customize further? Update the repository README with team-specific notes and share this guide internally.
          </p>
        </div>
      </main>

      <footer class="app-footer guide-footer">
        <div class="footer-inner">
          <div class="footer-brand">¬© <span id="guide_footer_year"></span> MundoGIS</div>
          <div class="footer-links">
            <a href="https://mundogis.se" target="_blank" rel="noopener">mundogis.se</a>
            <a href="mailto:info@mundogis.se">info@mundogis.se</a>
          </div>
        </div>
      </footer>
    </div>

    <script>
      (function(){
        const SUPPORTED_LANGS = ["en", "es", "sv"];
        const DEFAULT_TEXT = {};
        const DEFAULT_HTML = {};
        const TRANSLATIONS = {
          es: {
            "guide.pageTitle": "Gu√≠a de usuario ¬∑ Qtiler",
            "guide.back": "‚¨Ö Volver al panel",
            "guide.heroTitle": "Gu√≠a r√°pida y flujo de trabajo",
            "guide.heroSubtitle": "Todo lo necesario para preparar proyectos QGIS, generar cach√©s de capas o temas con Qtiler y publicar WMTS listos para producci√≥n.",
            "guide.section1Title": "Preparativos",
            "guide.prepareQgis": "Preparar QGIS",
            "guide.prepareQgis.step1": "Crea y guarda tu proyecto en QGIS 3.x con todas las capas estilizadas.",
            "guide.prepareQgis.step2": "Define \"Map Themes\" (Kartteman) para cada combinaci√≥n de capas que quieras cachear como mosaico compuesto.",
            "guide.prepareQgis.step3": "Guarda el proyecto (<code>Ctrl+S</code>) antes de subirlo para conservar los temas.",
            "guide.setupServer": "Configurar el servidor",
            "guide.setupServer.step1": "Instala OSGeo4W o la versi√≥n aut√≥noma de QGIS y configura <code>QGIS_PREFIX</code>, <code>OSGEO4W_BIN</code>, <code>PYTHON_EXE</code>.",
            "guide.setupServer.step2": "Inicia Qtiler con <code>npm start</code> (por defecto <code>http://localhost:3000</code>).",
            "guide.setupServer.step3": "Opcional: instala el servicio de Windows con <code>node service\\install-service.js</code>.",
            "guide.tip1": "¬øYa copiaste proyectos a <code>qgisprojects/</code>? Solo pulsa <strong>Recargar capas</strong> para reconstruir la lista.",
            "guide.section2Title": "Flujo en el panel",
            "guide.dashboardIntro": "Este es el recorrido completo dentro del panel. Sustituye las capturas en <code>public/assets</code> y actualiza las referencias si quieres a√±adir im√°genes.",
            "guide.dashboardOverview": "Resumen del panel",
            "guide.dashboardOverview.body": "Marcador de posici√≥n de captura. Sustituye <code>dashboard-overview.png</code> por tu propia imagen.",
            "guide.layerControls": "Controles de capa",
            "guide.layerControls.body": "Muestra las acciones de capa (reproducir, eliminar, copiar URL, visor). Sustituye <code>layer-controls.png</code> por tu propia imagen.",
            "guide.uploadRefresh": "1Ô∏è‚É£ Subir o refrescar proyectos",
            "guide.uploadRefresh.body": "Usa <strong>Subir proyecto</strong> para `.qgs/.qgz`. Qtiler los coloca en <code>qgisprojects/</code> y extrae capas, CRS, extensi√≥n y temas. Las copias manuales tambi√©n sirven: pulsa <strong>Recargar capas</strong>.",
            "guide.adjustZoom": "2Ô∏è‚É£ Ajustar zoom y extensi√≥n",
            "guide.adjustZoom.body": "Define el zoom m√≠nimo/m√°ximo global y abre <strong>Mostrar mapa de extensi√≥n</strong> cuando necesites un bbox preciso. El mapa permite gran zoom (‚âà1:100) para refinar la caja en WGS84.",
            "guide.cachePerLayer": "3Ô∏è‚É£ Cachear por capa",
            "guide.cachePerLayer.intro": "Cada fila de capa ofrece:",
            "guide.cachePerLayer.option1": "‚ñ∂ Generar o actualizar la cach√©.",
            "guide.cachePerLayer.option2": "üóë Eliminar teselas guardadas.",
            "guide.cachePerLayer.option3": "üìã Copiar URL de teselas (`/wmts/<project>/<layer>/{z}/{x}/{y}.png`).",
            "guide.cachePerLayer.option4": "üëÅ Abrir el visor Leaflet en el CRS nativo de la capa.",
            "guide.cachePerTheme": "4Ô∏è‚É£ Cachear por tema",
            "guide.cachePerTheme.body": "La secci√≥n <strong>Map Themes</strong> lista cada tema detectado. Usa ‚ñ∂ para generar el mosaico compuesto (`/wmts/&lt;project&gt;/themes/&lt;theme&gt;/‚Ä¶`). Copia la URL WMTS y pr√©visual√≠zala en el visor.",
            "guide.section3Title": "Tareas y automatizaci√≥n",
            "guide.projectWideCache": "Cacheo por proyecto",
            "guide.projectWideCache.body": "<strong>Cachear todas las capas</strong> inicia un trabajo por lotes que recorre cada capa con los par√°metros actuales. El panel \"Tareas en ejecuci√≥n\" muestra el progreso en vivo.",
            "guide.scheduledRecache": "Recacheo programado",
            "guide.scheduledRecache.body": "Abre el men√∫ de recacheo para definir intervalos en minutos. El servidor guarda el √∫ltimo resultado y la siguiente ejecuci√≥n en <code>project-config.json</code>.",
            "guide.tip2": "Las cach√©s viven en <code>cache/&lt;project&gt;/</code>. Cada ejecuci√≥n actualiza <code>index.json</code> con <code>kind</code>, niveles de zoom, capas de origen y marcas de tiempo.",
            "guide.section4Title": "Publicar WMTS",
            "guide.section4.body": "El backend expone un endpoint m√≠nimo de GetCapabilities en <code>/wmts?SERVICE=WMTS&amp;REQUEST=GetCapabilities&amp;project=&lt;id&gt;</code>. Todas las capas y temas cacheados aparecen como capas WMTS listas para usar.",
            "guide.gisIntegration": "Integraci√≥n en clientes GIS",
            "guide.gisIntegration.body1": "Carga la URL de capacidades para registrar todas las capas de una vez.",
            "guide.gisIntegration.body2": "Usa URLs de teselas individuales cuando solo necesites un recurso espec√≠fico.",
            "guide.gisIntegration.body3": "Los temas se identifican como <code>&lt;project&gt;:&lt;theme&gt;</code> y se guardan bajo <code>_themes/</code>.",
            "guide.leafletViewer": "Visor Leaflet",
            "guide.leafletViewer.body": "El visor integrado (<code>viewer.html</code>) maneja CRS personalizados mediante Proj4, muestra una barra de escala y permite zoom extra para validar la calidad antes de publicar.",
            "guide.section5Title": "Buenas pr√°cticas",
            "guide.bestPractice1": "Mant√©n organizados los proyectos y temas de QGIS: sus nombres se usan directamente en las rutas WMTS.",
            "guide.bestPractice2": "Controla el uso de disco; las cach√©s WMTS pueden crecer r√°pido. Limpia capas que no utilices.",
            "guide.bestPractice3": "Revisa los registros (`logs/`) y los mensajes del panel para detectar errores de renderizado a tiempo.",
            "guide.bestPractice4": "Usa cuentas de Windows dedicadas y servicios en segundo plano para despliegues de producci√≥n.",
            "guide.footer": "¬øNecesitas personalizar m√°s? Actualiza el README del repositorio con notas internas y comparte esta gu√≠a con el equipo."
          },
          sv: {
            "guide.pageTitle": "Anv√§ndarguide ¬∑ Qtiler",
            "guide.back": "‚¨Ö Tillbaka till panelen",
            "guide.heroTitle": "Snabbstart och arbetsfl√∂de",
            "guide.heroSubtitle": "Allt du beh√∂ver f√∂r att f√∂rbereda QGIS-projekt, skapa lager- eller temacache med Qtiler och publicera produktionsklar WMTS.",
            "guide.section1Title": "F√∂rberedelser",
            "guide.prepareQgis": "F√∂rbered QGIS",
            "guide.prepareQgis.step1": "Skapa och spara ditt projekt i QGIS 3.x med alla lager stylade.",
            "guide.prepareQgis.step2": "Definiera \"Map Themes\" (Kartteman) f√∂r varje lagerkombination som ska cachas som mosaik.",
            "guide.prepareQgis.step3": "Spara projektet (<code>Ctrl+S</code>) innan du laddar upp s√• att temana f√∂ljer med.",
            "guide.setupServer": "Konfigurera servern",
            "guide.setupServer.step1": "Installera OSGeo4W eller frist√•ende QGIS och s√§tt upp <code>QGIS_PREFIX</code>, <code>OSGEO4W_BIN</code>, <code>PYTHON_EXE</code>.",
            "guide.setupServer.step2": "Starta Qtiler med <code>npm start</code> (standard <code>http://localhost:3000</code>).",
            "guide.setupServer.step3": "Valfritt: installera Windows-tj√§nsten via <code>node service\\install-service.js</code>.",
            "guide.tip1": "Har du redan kopierat projekt till <code>qgisprojects/</code>? Klicka bara p√• <strong>Ladda om lager</strong> f√∂r att √•terst√§lla listan.",
            "guide.section2Title": "Panelarbetsfl√∂de",
            "guide.dashboardIntro": "H√§r √§r hela arbetsfl√∂det i panelen. Byt ut sk√§rmdumparna i <code>public/assets</code> och uppdatera referenserna om du vill visa egna bilder.",
            "guide.dashboardOverview": "Panel√∂versikt",
            "guide.dashboardOverview.body": "Platsh√•llare f√∂r sk√§rmdump. Ers√§tt <code>dashboard-overview.png</code> med din egen bild.",
            "guide.layerControls": "Kontroller f√∂r lager",
            "guide.layerControls.body": "Visa lager√•tg√§rder (starta, ta bort, kopiera URL, visare). Ers√§tt <code>layer-controls.png</code> med din egen bild.",
            "guide.uploadRefresh": "1Ô∏è‚É£ Ladda upp eller uppdatera projekt",
            "guide.uploadRefresh.body": "Anv√§nd <strong>Ladda upp projekt</strong> f√∂r `.qgs/.qgz`-filer. Qtiler placerar dem i <code>qgisprojects/</code> och extraherar lager, CRS, utbredning och teman. Manuella kopior fungerar ocks√• ‚Äì klicka bara p√• <strong>Ladda om lager</strong>.",
            "guide.adjustZoom": "2Ô∏è‚É£ Justera zoom och utbredning",
            "guide.adjustZoom.body": "S√§tt globalt min/max-zoom och √∂ppna <strong>Visa utbredningskarta</strong> n√§r du beh√∂ver exakt bounding box. Kartan st√∂der djup zoom (‚âà1:100) s√• att du kan finjustera rutan i WGS84.",
            "guide.cachePerLayer": "3Ô∏è‚É£ Cacha per lager",
            "guide.cachePerLayer.intro": "Varje lagerrad erbjuder:",
            "guide.cachePerLayer.option1": "‚ñ∂ Generera eller uppdatera cache.",
            "guide.cachePerLayer.option2": "üóë Ta bort sparade tiles.",
            "guide.cachePerLayer.option3": "üìã Kopiera tile-URL (`/wmts/<project>/<layer>/{z}/{x}/{y}.png`).",
            "guide.cachePerLayer.option4": "üëÅ √ñppna Leaflet-visaren i lagrets egna CRS.",
            "guide.cachePerTheme": "4Ô∏è‚É£ Cacha per tema",
            "guide.cachePerTheme.body": "Avsnittet <strong>Map Themes</strong> listar alla hittade teman. Anv√§nd ‚ñ∂ f√∂r att skapa mosaiken (`/wmts/&lt;project&gt;/themes/&lt;theme&gt;/‚Ä¶`). Kopiera WMTS-URL:en och f√∂rhandsgranska i visaren.",
            "guide.section3Title": "Jobb och automatisering",
            "guide.projectWideCache": "Projektcache",
            "guide.projectWideCache.body": "<strong>Cacha alla lager</strong> startar ett batchjobb som g√•r igenom varje lager med aktuella parametrar. Panelen \"P√•g√•ende uppgifter\" visar status i realtid.",
            "guide.scheduledRecache": "Schemalagd omcache",
            "guide.scheduledRecache.body": "√ñppna omcache-menyn f√∂r att ange intervall i minuter. Servern sparar senaste resultatet och n√§sta k√∂rning i <code>project-config.json</code>.",
            "guide.tip2": "Caches finns i <code>cache/&lt;project&gt;/</code>. Varje k√∂rning uppdaterar <code>index.json</code> med <code>kind</code>, zoomniv√•er, k√§llager och tidsst√§mplar.",
            "guide.section4Title": "Publicera WMTS",
            "guide.section4.body": "Backend:en exponerar ett minimalt GetCapabilities-endpoint p√• <code>/wmts?SERVICE=WMTS&amp;REQUEST=GetCapabilities&amp;project=&lt;id&gt;</code>. Alla cachade lager och teman visas som f√§rdiga WMTS-lager.",
            "guide.gisIntegration": "GIS-klientintegration",
            "guide.gisIntegration.body1": "Ladda URL:en f√∂r Capabilities f√∂r att registrera alla lager p√• en g√•ng.",
            "guide.gisIntegration.body2": "Anv√§nd enskilda tile-URL:er n√§r du bara beh√∂ver en specifik resurs.",
            "guide.gisIntegration.body3": "Teman identifieras som <code>&lt;project&gt;:&lt;theme&gt;</code> och lagras under <code>_themes/</code>.",
            "guide.leafletViewer": "Leaflet-visaren",
            "guide.leafletViewer.body": "Den inbyggda visaren (<code>viewer.html</code>) hanterar egna CRS via Proj4, visar skala och l√•ter dig zooma in extra f√∂r att kontrollera kvalitet innan publicering.",
            "guide.section5Title": "B√§sta praxis",
            "guide.bestPractice1": "H√•ll QGIS-projekt och teman organiserade ‚Äì namnen anv√§nds direkt i WMTS-s√∂kv√§garna.",
            "guide.bestPractice2": "√ñvervaka diskutrymme; WMTS-cache kan v√§xa snabbt. Rensa lager du inte beh√∂ver.",
            "guide.bestPractice3": "Granska loggarna (`logs/`) och panelens statusmeddelanden f√∂r att hitta renderingsfel tidigt.",
            "guide.bestPractice4": "Anv√§nd dedikerade Windows-konton och bakgrundstj√§nster f√∂r produktionsmilj√∂er.",
            "guide.footer": "Beh√∂ver du anpassa mer? Uppdatera projektets README med teamets anteckningar och dela guiden internt."
          }
        };

        const normalizeLang = (value) => {
          const raw = (value || "").toLowerCase();
          if (SUPPORTED_LANGS.includes(raw)) return raw;
          const base = raw.split("-")[0];
          return SUPPORTED_LANGS.includes(base) ? base : "en";
        };

        let currentLang = normalizeLang(localStorage.getItem("qtiler.lang") || navigator.language || "en");

        const captureDefaults = () => {
          document.querySelectorAll("[data-i18n]").forEach(el => {
            const key = el.getAttribute("data-i18n");
            if (!key || key in DEFAULT_TEXT) return;
            const explicit = el.getAttribute("data-i18n-default");
            DEFAULT_TEXT[key] = explicit != null ? explicit : el.textContent.trim();
          });
          document.querySelectorAll("[data-i18n-html]").forEach(el => {
            const key = el.getAttribute("data-i18n-html");
            if (!key || key in DEFAULT_HTML) return;
            const explicit = el.getAttribute("data-i18n-default");
            DEFAULT_HTML[key] = explicit != null ? explicit : el.innerHTML.trim();
          });
        };

        const tr = (key) => {
          if (!key) return "";
          const table = TRANSLATIONS[currentLang] || {};
          const fallback = DEFAULT_TEXT[key] ?? DEFAULT_HTML[key] ?? "";
          return table[key] ?? fallback;
        };

        const applyTranslations = () => {
          document.documentElement.setAttribute("lang", currentLang);
          const titleTranslation = tr("guide.pageTitle");
          if (titleTranslation) document.title = titleTranslation;
          document.querySelectorAll("[data-i18n]").forEach(el => {
            const key = el.getAttribute("data-i18n");
            if (!key) return;
            el.textContent = tr(key);
          });
          document.querySelectorAll("[data-i18n-html]").forEach(el => {
            const key = el.getAttribute("data-i18n-html");
            if (!key) return;
            el.innerHTML = tr(key);
          });
          const backLink = document.querySelector("a[data-i18n=guide.back]");
          if (backLink) backLink.setAttribute("aria-label", tr("guide.back"));
        };

        const navLanguageSelect = document.getElementById("language_selector");
        const secondaryLanguageSelect = document.getElementById("guide_language_selector");

        const syncSelects = () => {
          if (navLanguageSelect) navLanguageSelect.value = currentLang;
          if (secondaryLanguageSelect) secondaryLanguageSelect.value = currentLang;
        };

        const setLanguage = (lang) => {
          currentLang = normalizeLang(lang);
          localStorage.setItem("qtiler.lang", currentLang);
          applyTranslations();
          syncSelects();
        };

        captureDefaults();
        applyTranslations();
        syncSelects();

        if (navLanguageSelect) {
          navLanguageSelect.addEventListener("change", (event) => setLanguage(event.target.value));
        }
        if (secondaryLanguageSelect) {
          secondaryLanguageSelect.addEventListener("change", (event) => setLanguage(event.target.value));
        }

        const footerYearEl = document.getElementById("guide_footer_year");
        if (footerYearEl) footerYearEl.textContent = String(new Date().getFullYear());
      })();
    </script>
  </body>
</html>
